{% extends "base_admin.html" %}

{% block title %}Inventory - OTT RADAR{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-section">
        <div class="section-head">
            <div>
                <h2><i class="fas fa-database"></i> Inventory</h2>
                <p class="section-desc">Filter movies with missing data and open them for edits.</p>
            </div>
            <form method="POST" action="{{ url_for('admin_movie_search') }}" class="inventory-search">
                <input type="text" name="search_query" placeholder="Search TMDB ID or title" required>
                <button type="submit"><i class="fas fa-search"></i> Search</button>
            </form>
        </div>

        <div class="filter-pills">
            <a class="filter-pill {% if filter_type == 'all' %}active{% endif %}" href="/admin/inventory?filter=all">All</a>
            <a class="filter-pill {% if filter_type == 'missing_trailer' %}active{% endif %}" href="/admin/inventory?filter=missing_trailer">Missing Trailer</a>
            <a class="filter-pill {% if filter_type == 'missing_ott' %}active{% endif %}" href="/admin/inventory?filter=missing_ott">Missing OTT</a>
            <a class="filter-pill {% if filter_type == 'missing_poster' %}active{% endif %}" href="/admin/inventory?filter=missing_poster">Missing Poster</a>
            <a class="filter-pill {% if filter_type == 'missing_overview' %}active{% endif %}" href="/admin/inventory?filter=missing_overview">Missing Overview</a>
            <a class="filter-pill {% if filter_type == 'missing_cast' %}active{% endif %}" href="/admin/inventory?filter=missing_cast">Missing Cast</a>
            <a class="filter-pill {% if filter_type == 'missing_genres' %}active{% endif %}" href="/admin/inventory?filter=missing_genres">Missing Genres</a>
            <a class="filter-pill {% if filter_type == 'missing_runtime' %}active{% endif %}" href="/admin/inventory?filter=missing_runtime">Missing Runtime</a>
            <a class="filter-pill {% if filter_type == 'missing_rating' %}active{% endif %}" href="/admin/inventory?filter=missing_rating">Missing Rating</a>
        </div>
    </div>

    <div class="admin-section">
        {% if movies %}
        <div class="inventory-grid">
            {% for movie in movies %}
            <div class="inventory-card" style="display: flex; gap: 1.2rem; align-items: flex-start; padding: 1.1rem 1.2rem;">
                <div class="inventory-poster">
                    {% if movie.poster %}
                        <img src="{{ movie.poster }}" alt="{{ movie.title }}" style="width: 80px; height: 120px; object-fit: cover; border-radius: 8px;">
                    {% else %}
                        <div class="poster-placeholder" style="width: 80px; height: 120px;"><i class="fas fa-image"></i></div>
                    {% endif %}
                </div>
                <div class="inventory-info" style="flex:1; min-width:0;">
                    <div style="display: flex; align-items: center; gap: 0.7rem; justify-content: space-between;">
                        <h3 style="margin:0; font-size:1.05rem; font-weight:700; color:var(--text-primary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">{{ movie.title }}</h3>
                        <span style="font-size:0.92rem; color:var(--text-secondary);">{{ movie.release_date[:4] if movie.release_date else 'N/A' }}</span>
                    </div>
                    <div class="inventory-meta" style="margin:0.2rem 0 0.5rem 0; display:flex; gap:0.7rem; font-size:0.92rem; color:var(--text-secondary);">
                        <span>TMDB: {{ movie.tmdb_id }}</span>
                        <span>{{ language_map.get(movie.language, movie.language or 'n/a') }}</span>
                        {% if movie.rating %}<span>‚≠ê {{ '%.1f'|format(movie.rating) }}</span>{% endif %}
                        {% if movie.ott_platforms and movie.ott_platforms != '{}' %}<span><i class="fas fa-tv"></i> OTT</span>{% endif %}
                    </div>
                    <div class="missing-badges" style="margin-bottom:0.5rem;">
                        {% if not movie.youtube_trailer_id %}<span class="badge badge-outline-danger">No Trailer</span>{% endif %}
                        {% if movie.ott_platforms == '{}' or not movie.ott_platforms %}<span class="badge badge-outline-warning">No OTT</span>{% endif %}
                        {% if not movie.cast %}<span class="badge badge-outline-info">No Cast</span>{% endif %}
                        {% if movie.is_active %}<span class="badge badge-success">Live</span>{% else %}<span class="badge badge-dark">Draft</span>{% endif %}
                    </div>
                    <div class="inventory-actions" style="display:flex; gap:0.5rem;">
                        <a class="btn-primary" href="{{ url_for('admin_movie_search', q=movie.tmdb_id) }}">Edit</a>
                        <a class="btn-secondary" href="/movie/{{ movie.tmdb_id }}" target="_blank">Preview</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="empty-state">No movies found for this filter.</p>
        {% endif %}
    </div>
</div>

<style>
.inventory-grid {
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
}
.inventory-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  border: 1px solid var(--border);
  transition: box-shadow 0.2s;
  display: flex;
  gap: 1.2rem;
  align-items: flex-start;
  padding: 1.1rem 1.2rem;
}
.inventory-card:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}
.inventory-poster img {
  width: 80px;
  height: 120px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid var(--border);
}
.poster-placeholder {
  width: 80px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f5f5f5;
  color: #bbb;
  font-size: 2rem;
  border-radius: 8px;
  border: 1px solid var(--border);
}
.inventory-info {
  flex: 1;
  min-width: 0;
}
.inventory-meta {
  margin: 0.2rem 0 0.5rem 0;
  display: flex;
  gap: 0.7rem;
  font-size: 0.92rem;
  color: var(--text-secondary);
  flex-wrap: wrap;
}
.missing-badges {
  margin-bottom: 0.5rem;
  display: flex;
  gap: 0.4rem;
  flex-wrap: wrap;
}
.badge {
  display: inline-block;
  padding: 0.2rem 0.7rem;
  border-radius: 999px;
  font-size: 0.85rem;
  font-weight: 600;
  background: #eee;
  color: #333;
  border: 1px solid #ddd;
}
.badge-success {
  background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);
  color: #fff;
  border: none;
}
.badge-dark {
  background: #444;
  color: #fff;
  border: none;
}
.badge-outline-danger {
  background: #fff;
  color: #e53935;
  border: 1px solid #e53935;
}
.badge-outline-warning {
  background: #fff;
  color: #ffb300;
  border: 1px solid #ffb300;
}
.badge-outline-info {
  background: #fff;
  color: #039be5;
  border: 1px solid #039be5;
}
.btn-primary {
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.2s;
}
.btn-primary:hover {
  background: #1565c0;
}
.btn-secondary {
  background: #fff;
  color: #1976d2;
  border: 1px solid #1976d2;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.2s, color 0.2s;
}
.btn-secondary:hover {
  background: #1976d2;
  color: #fff;
}
.filter-pills {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1.2rem;
  flex-wrap: wrap;
}
.filter-pill {
  background: #f5f5f5;
  color: #1976d2;
  border-radius: 999px;
  padding: 0.3rem 1rem;
  font-size: 0.92rem;
  font-weight: 600;
  text-decoration: none;
  border: 1px solid #1976d2;
  transition: background 0.2s, color 0.2s;
}
.filter-pill.active, .filter-pill:hover {
  background: #1976d2;
  color: #fff;
}
.inventory-actions {
  display: flex;
  gap: 0.5rem;
}
.empty-state {
  color: #888;
  font-size: 1.1rem;
  text-align: center;
  margin-top: 2rem;
}
.section-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 1rem;
}
.inventory-search {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}
.inventory-search input {
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 0.4rem 0.8rem;
  font-size: 1rem;
}
.inventory-search button {
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 0.4rem 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s;
}
.inventory-search button:hover {
  background: #1565c0;
}
</style>
{% endblock %}
